<div class="container-fluid book-details-container">
  <div class="row">
    <div class="col-4">
      <img class="book-cover img-fluid"
           *ngIf="book.cover" src="{{'data:image/jpg;base64,' + book.cover}}" [alt]="book.title"
           alt="Card image cap">
    </div>

    <div class="col-6">
      <h1>{{book.title}}</h1>

      <h5 class="mt-3">{{book.authors}}</h5>

      <ng-template #t let-fill="fill">
            <span class="star mb-3" [class.full]="fill === 100">
              <span class="half" [style.width.%]="fill">&#9733;</span>&#9733;
            </span>
      </ng-template>
      <ngb-rating [(rate)]="book.ratingAverage" [starTemplate]="t" [readonly]="true" [max]="5"></ngb-rating>
      <br>

      <a role="button" class="wishlist" [ngClass]="{ 'readlist': book.addedToReadList === true }" (click)="updateIsAddedToReadList(book)">&#9825; Add to Readlist</a>

      <h4 class="mt-5">Description</h4>
      <p class="mt-3">{{book.description}}</p>
    </div>
  </div>

  <div class="row mt-3">
    <div class="col-12">
      <h4 class="mt-3">Reviews</h4>
    </div>
    <div class="col-8">
      <div class="col-12 mt-3 tab-panel">
        <div class="row">
          <div class="col-6  mt-3">
            <h3>{{ratings.length}} review for {{book.title}} </h3>
            <div *ngFor="let rating of ratings" class="col-10 mt-3 message-panel">
              <div class="row">
                <div class="col-12">
                  <ngb-rating class="rating-stars"
                              [rate]="rating.stars"
                              [readonly]="true"></ngb-rating>
                  <p class="userName"> {{rating.userName}} - {{ rating.date | date:'d MMMM, y' }}</p>
                </div>
                <div class="col-12 mt-3">
                  <h6>{{rating.title}}</h6>
                  <p>{{rating.message}}</p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-6  mt-3">
            <h3 class="mb-4">Add a review</h3>
            <form #ratingForm="ngForm">
              <div class="mb-3">
                <label for="title" class="form-label">Title*</label>
                <input type="text"
                       class="form-control"
                       id="title"
                       name="title"
                       placeholder="Rating Title"
                       [(ngModel)]="ratingRequest.title"
                       #title="ngModel"
                       [ngClass]="{ 'is-invalid': title.invalid && (title.dirty || title.touched) }"
                       required
                       minlength="4">

                <div *ngIf="title.invalid && (title.dirty || title.touched)" class="alert alert-danger">
                  <div *ngIf="title.errors?.required">
                    Title is required.
                  </div>
                  <div *ngIf="title.errors?.minlength">
                    Title must be at least 4 characters long.
                  </div>
                </div>

              </div>
              <div class="mb-3">
                <label for="message" class="form-label">Message*</label>
                <textarea class="form-control"
                          id="message"
                          name="message"
                          rows="3"
                          [(ngModel)]="ratingRequest.message"
                          #message="ngModel"
                          [ngClass]="{ 'is-invalid': message.invalid && (message.dirty || message.touched) }"
                          required
                          minlength="10"></textarea>

                <div *ngIf="message.invalid && (message.dirty || message.touched)" class="alert alert-danger">
                  <div *ngIf="message.errors?.required">
                    Message is required.
                  </div>
                  <div *ngIf="message.errors?.minlength">
                    Message must be at least 10 characters long.
                  </div>
                </div>

              </div>
              <div class="mb-3">
                <label for="stars" class="form-label">Rating*</label>
                <br>
                <ngb-rating class="rating-stars" id="stars" name="stars" [(ngModel)]="ratingRequest.stars"></ngb-rating>
              </div>
            </form>
            <button type="button" class="btn btn-primary mb-5" (click)="addRating()" [disabled]="!ratingForm.valid">
              Sumbit
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
